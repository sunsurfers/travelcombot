# travelcombot
TravelComBot is a Telegram bot for travel communities like [sunsurfers.ru](sunsurfers.ru) or [smenastation.com](smenastation.com)

<!-- toc -->

  * [Функциональные требования для пользователя:](#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%BE%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5-%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%B4%D0%BB%D1%8F-%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F)
  * [Функциональные требования для администратора:](#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%BE%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5-%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%B4%D0%BB%D1%8F-%D0%B0%D0%B4%D0%BC%D0%B8%D0%BD%D0%B8%D1%81%D1%82%D1%80%D0%B0%D1%82%D0%BE%D1%80%D0%B0)
- [Установка](#%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0)
  * [Запуск без Docker](#%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA-%D0%B1%D0%B5%D0%B7-docker)
  * [Запуск в Docker](#%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA-%D0%B2-docker)

<!-- tocstop -->

### Функциональные требования для пользователя:

Объединение пользователей бота в существующие сообщества путешественников: Сансерферы и Смена, посредством первичной регистрации пользователя.

- **Видимость текущей локации всех пользователей на карте с указанием никнеймов** (открытие карты по ссылке, активность которой ограничена по времени 10 минутами). При клике на никнейм всплывает активная ссылка на Telegram пользователя и дата обновления локации.
Видимость текущей локации всех пользователей бота, находящихся рядом с пользователем в радиусе 30 км, без использования карты внутри бота (в виде списка пользователей с указанием: никнейма и активной ссылки на Telegram пользователя, даты обновления локации).

- **Сохранение истории обновления локаций всех пользователей в базе.**
Проставление метки при выборе локации пользователя рядом с фактическим местонахождением в радиусе 3 км или в центре города.
- Регистрация пользователя в TravelСomBot. Вводимые данные для регистрации:
имя/никнейм,
аватарка,
краткое описание себя и своих интересов,
принадлежность к сообществу путешественников (Сансерферы или Смена, или и то, и другое), на каких мероприятиях сообществ участвовал,
имена трех людей, которые могут подтвердить, что пользователь относится к сообществу,
активные ссылки на соц.сети (Instagram, Facebook, VK).

- Предложение посредством уведомления заполнить данные профиля пользователя (не менее 3х раз).
- Просматривание пользователем профилей других пользователей.
- Написание сообщения одним пользователем другому в Telegram.
- Предложение пользователю обновить локацию 1 раз в 14 дней с правом отказа от обновления.
- Указание активной ссылки на Telegram пользователя, кликание на которую ведет к открытию диалогового окна переписки с пользователем в Telegram.
- Предложение пользователю заполнить данные о мероприятиях сообщества, в которых пользователь участвовал (не менее 3х раз)
- Просмотр карты должен осуществлять в окне по уникальному адресу
    - Если карта имеет большой масштаб, то должна осуществлять группировка пользователей в одной локации с указанием количества пользователей в данной локации. Например, в москве есть 25 пользователей и когда мы отзумливаем карту до масштаба России, в Москве должен появиться бабл с цифрой 25, а при обратном зуме снова распадаться на отдельных пользователей.

### Функциональные требования для администратора:
- Регистрация администратора (pre-seed базы данных).
- Авторизация администратора.
- Одобрение новых заявок пользователей для регистрации в TravelComBot.
- Проверка заявок новых пользователей на присутствие в white-листе.
- Право на выполнение базовых функций по управлению всеми сущностями базы данных: создание, чтение, - модификация, удаление.
- Введение новых категорий пользователей - новых сообществ путешественников.
- Отправка произвольного сообщения всем пользователям бота.


## Установка
Для того, что бы изменять админов в боте, необходимо отредактировать переменную ADMINS в файле config.py и вставить туда Telegram ID нужного аккаунта. После этого необходимо перезапустить бота

Бота необохимо добавить в чат, куда он будет присылать анкеты для проверки администратором

### Запуск без Docker

0. прописать переменные в файл `.env`

1. Установить зависимости

`pip install -r requirements.txt`

2. Загрузить дамп базы данных

`mysql ИМЯ_БАЗЫ -u ИМЯ_ПОЛЬЗОВАТЕЛЯ -p ПАРОЛЬ < schema.sql`

3. Запустить процесс бота

`python3 main.py`

### Запуск в Docker

1. Установить Docker

Установка Docker под Ubuntu - https://docs.docker.com/install/linux/docker-ce/ubuntu/

Установка Docker под Mac - https://docs.docker.com/docker-for-mac/install/

Установка Docker под Windows - https://docs.docker.com/docker-for-windows/install/

2. Прописать в `local_config_main.py` и `local_config_useradd.py` соответствующие токены в переменную `BOT_TOKEN`.

3. `docker-compose build`

4. `docker-compose up -d`

5. `docker-compose exec mysql mysql`, вставить туда содержимое schema.sql
